SHELL:= /bin/bash
.SILENT:
MAKEFLAGS += --warn-undefined-variables
.ONESHELL:

# error for undefined variables
check_defined = \
    $(strip $(foreach 1,$1, \
        $(call __check_defined,$1,$(strip $(value 2)))))
__check_defined = \
    $(if $(value $1),, \
      $(error Undefined $1$(if $2, ($2))))

prepare:
	$(call check_defined, OVERRIDE_EXTENSION, ENV_FOLDER_PATH, COMMON_NAME, CLOUD_HOST, FLICKR_PRIVATE_KEY, FLICKR_PUBLIC_KEY, UNSPLASH_PRIVATE_KEY, UNSPLASH_PUBLIC_KEY, PEXELS_PUBLIC_KEY, AWS_REGION_NAME, AWS_ACCESS_KEY, AWS_SECRET_KEY, PACKAGE_NAME, CONFIG_FOLDER_PATH)
	cat <<-EOF > ${ENV_FOLDER_PATH}/${OVERRIDE_EXTENSION}.env
		COMMON_NAME=${COMMON_NAME}
		CLOUD_HOST=${CLOUD_HOST}
		FLICKR_PRIVATE_KEY=${FLICKR_PRIVATE_KEY}
		FLICKR_PUBLIC_KEY=${FLICKR_PUBLIC_KEY}
		UNSPLASH_PRIVATE_KEY=${UNSPLASH_PRIVATE_KEY}
		UNSPLASH_PUBLIC_KEY=${UNSPLASH_PUBLIC_KEY}
		PEXELS_PUBLIC_KEY=${PEXELS_PUBLIC_KEY}
		AWS_REGION_NAME=${AWS_REGION_NAME}
		AWS_ACCESS_KEY=${AWS_ACCESS_KEY}
		AWS_SECRET_KEY=${AWS_SECRET_KEY}
	EOF
	sed -i 's/package .*/package ${PACKAGE_NAME}/' ${CONFIG_FOLDER_PATH}/config_override.go